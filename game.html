<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body style="background-image: linear-gradient(rgb(40,40,40),rgb(0,0,0));">
    <div style="width:100%; height:100%; position:absolute; z-index: 1;background-image: radial-gradient(rgba(0,0,0,0),rgba(0,0,0,1))"></div>
    <canvas id="canvas"></canvas>
    <script>
      const canvas = document.getElementById("canvas")
const ctx = canvas.getContext("2d")
canvas.width = window.innerWidth
canvas.height = window.innerHeight
var tempColor = "blue"

var findColor = (type) => {
    switch(type){
        case 0:
            return "rgb(0,0,0)"
        case 1:
            return "rgb(70,70,70)"
        case 2:
            return "rgb(0,200,0)"
        case 3:
            return "rgb(60,60,60)"
    }
}

var movePlayer = () => {
    var findCell = (x,y) => {
        x/=player.levelData.mag
        x-=0.5
        y/=player.levelData.mag
        y-=0.5
        if(y>player.level.length-1||y<0||x>player.level[y].length-1||x<0){
            return 0
        }
        return player.level[y][x]
    }
    var changeCell = (x,y,to) => {
        x/=player.levelData.mag
        x-=0.5
        y/=player.levelData.mag
        y-=0.5
        if(y>player.level.length-1||y<0||x>player.level[y].length-1||x<0){
            return
        }
        player.level[y][x] = to
    }
    var determineCollision = (x,y,cellX,cellY) => {
        if(x>cellX-50&&x<cellX+50&&y>cellY-50&&y<cellY+50){
            return true
        }
        return false
    }

    if(determineCollision(player.levelData.mag*Math.cos(player.auxRot)+player.x,player.levelData.mag*Math.sin(player.auxRot)+player.y,player.x-player.levelData.mag,player.y)&&findCell(player.x-player.levelData.mag,player.y)!=0){
        player.x-=player.levelData.mag
        player.auxRot=0
        if(findCell(player.x,player.y)==2){
            player.score+=10000
            changeCell(player.x,player.y,3)
        }
        if(tempColor=="green"){
            tempColor="blue"
        } else{
            tempColor="green"
        }
        return
    }
    if(determineCollision(player.levelData.mag*Math.cos(player.auxRot)+player.x,player.levelData.mag*Math.sin(player.auxRot)+player.y,player.x+100,player.y)&&findCell(player.x+player.levelData.mag,player.y)!=0){
        player.x+=player.levelData.mag
        player.auxRot=Math.PI
        if(findCell(player.x,player.y)==2){
            player.score+=10000
            changeCell(player.x,player.y,3)
        }
        if(tempColor=="green"){
            tempColor="blue"
        } else{
            tempColor="green"
        }
        return
    }
    if(determineCollision(player.levelData.mag*Math.cos(player.auxRot)+player.x,player.levelData.mag*Math.sin(player.auxRot)+player.y,player.x,player.y-100)&&findCell(player.x,player.y-player.levelData.mag)!=0){
        player.y-=player.levelData.mag
        player.auxRot=0.5*Math.PI
        if(findCell(player.x,player.y)==2){
            player.score+=10000
            changeCell(player.x,player.y,3)
        }
        if(tempColor=="green"){
            tempColor="blue"
        } else{
            tempColor="green"
        }
        return
    }
    if(determineCollision(player.levelData.mag*Math.cos(player.auxRot)+player.x,player.levelData.mag*Math.sin(player.auxRot)+player.y,player.x,player.y+100)&&findCell(player.x,player.y+player.levelData.mag)!=0){
        player.y+=player.levelData.mag
        player.auxRot+=Math.PI
        if(findCell(player.x,player.y)==2){
            player.score+=10000
            changeCell(player.x,player.y,3)
        }
        if(tempColor=="green"){
            tempColor="blue"
        } else{
            tempColor="green"
        }
        return
    }
}

var player = {
    x:100*1.5,
    y:100*1.5,
    score: 0,
    auxRot:0,
    camX:0,
    camY:0,
    level:[
        [0,2,1,1,1,1,1,1,1],
        [0,1,0,0,0,1,0,0,0],
        [1,1,1,1,1,1,0,0,1],
        [0,1,1,1,0,0,0,0,1],
        [0,1,1,1,1,1,1,1,1]
        ],
    levelData: {mag:100.0},
}

var main = () => {
    ctx.clearRect(0,0,canvas.width,canvas.height)

    //cam interpolation, follows the player with the camera
    player.camX+=0.1*(player.x-player.camX-canvas.width/2)
    player.camY+=0.1*(player.y-player.camY-canvas.height/2)

    //drawing
    for(var y in player.level){
        for(var x in player.level[y]){
            if(player.level[y][x]==0){
                continue
            }
            ctx.beginPath()
            ctx.rect(x*player.levelData.mag-player.camX,y*player.levelData.mag-player.camY,player.levelData.mag,player.levelData.mag)
            ctx.fillStyle = findColor(player.level[y][x])
            ctx.fill()
            ctx.strokeStyle = "black"
            ctx.stroke()
        }
    }

    ctx.beginPath()
    ctx.fillStyle = tempColor
    ctx.arc(player.x-player.camX,player.y-player.camY,player.levelData.mag/3,0,2*Math.PI)
    ctx.fill()

    player.auxRot+=0.025 * Math.PI
    if(player.auxRot>=2*Math.PI){
        player.auxRot-=2*Math.PI
    }
    ctx.beginPath()
    ctx.fillStyle = "green"
    if(tempColor=="green"){
        ctx.fillStyle = "blue"
    }
    ctx.arc(player.levelData.mag*Math.cos(player.auxRot)+player.x-player.camX,player.levelData.mag*Math.sin(player.auxRot)+player.y-player.camY,player.levelData.mag/3,0,2*Math.PI)
    ctx.fill()

    requestAnimationFrame(main)
}
main()


window.addEventListener("keydown",function(){
    movePlayer()
})
    </script>
</body>
</html>
